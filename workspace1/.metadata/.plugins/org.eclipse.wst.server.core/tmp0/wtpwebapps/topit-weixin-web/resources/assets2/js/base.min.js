/*!
 * Project BI
 * Author he.ff (RTX 3113)
 * Email he.ff@wonhigh.cn
 * Date 2015/02/05
 * Description EasyUI for BI v1.0.0 (http://www.wonhigh.cn/)
 */
function resetDetailViewHeight(a){parent.$("#ddv-"+parent.editRowIndex)[0]&&(parent.$("#ddv-"+parent.editRowIndex).height(a),parent.tbgrid.datagrid("fixDetailRowHeight",parent.editRowIndex))}function addDataGridCommon(a){var b=$("#"+a);b.datagrid("appendRow",{});var c=b.datagrid("getRows");b.datagrid("beginEdit",c.length-1),b.datagrid("selectRow",c.length-1)}function removeDataGridCommon(a){var b=$("#"+a),c=b.datagrid("getSelected");if(c){var d=b.datagrid("getRowIndex",c);b.datagrid("deleteRow",d),d-1>=0&&b.datagrid("selectRow",d-1)}}function deleteAllGridCommon(){$("#"+datagridId).datagrid("loadData",{total:0,rows:[]})}function getRowIndex(a){var b=$(a).closest("tr.datagrid-row");return parseInt(b.attr("datagrid-row-index"))}function endEditCommon(a){for(var b=$("#"+a),c=b.datagrid("getRows"),d=0;d<c.length;d++)b.datagrid("endEdit",d)}function getChangeTableDataCommon(a){var b=$("#"+a);endEditCommon(a);var c=new Object;if(b.datagrid("getChanges").length){var d=b.datagrid("getChanges","inserted"),e=b.datagrid("getChanges","deleted"),f=b.datagrid("getChanges","updated");d.length&&(c.inserted=JSON.stringify(d)),e.length&&(c.deleted=JSON.stringify(e)),f.length&&(c.updated=JSON.stringify(f))}return c}function selectCheckAllRowCommon(a,b){for(var c=$("#"+a).datagrid("getRows"),d=0;d<c.length;d++)0==b?$("#"+a).datagrid("uncheckRow",d):$("#"+a).datagrid("checkRow",d)}function returnTab(a,b){$("#"+a).tabs("select",b)}function ajaxRequest(a,b,c){$.ajax({type:"POST",url:a,data:b,cache:!0,success:c})}function ajaxRequestAsync(a,b,c){$.ajax({type:"POST",url:a,data:b,cache:!0,async:!1,success:c})}function formatDateStr(a){return null==a||""==a?"":a.length>10?a.substring(0,10):a}function checkPowerJS(a,b){var c=!1,d=parseInt(Math.pow(2,b)),e=a&d;return e==d&&(c=!0),c}function showSuc(a){top.$.messager.show({title:"提示",msg:a,timeout:1e3,position:"bottomRight",showType:"slide"})}function showInfo(a){top.$.messager.alert("提示",a,"info")}function showWarn(a){top.$.messager.alert("提示",a,"warning")}function showError(a){top.$.messager.alert("提示",a,"error")}function showProcess(a,b){return a?void top.$.messager.progress({msg:b,text:""}):void top.$.messager.progress("close")}function showConfirm(a,b){top.$.messager.confirm(a,function(a){a&&"function"==typeof b&&b()})}function alert(a,b){var c="info";c=1==b?"warning":2==b?"error":3==b?"question":4==b?"success":"info",$.messager.alert("提示",a,c)}function popSearch(a,b){$(a).hasClass("search-down-arr")?($(b).layout("show","north"),$(a).attr("class","search-up-arr")):($(b).layout("hidden","north"),$(a).attr("class","search-down-arr"))}function toolSearch(a){var b=$("<div>").attr("id","searchDiv").addClass("simple-search-box"),c=$("<a>").attr({id:"searchArr",href:"javascript:;"}).addClass("search-up-arr"),d=$("<div>").addClass("toolbar_menu"),a=a||{collapsible:!0,items:[]},e=a.target||$("#subLayout"),f=a.appendTo||$("#toolbar"),g=a.items,h=a.width||250,i=a.pos||"right";if(f.css({position:"relative"}),g&&g.length>0){for(var j=0;j<g.length;j++){var k=$("<div>");k.attr("name",g[j].name).html(g[j].text),d.append(k)}b.append('<input class="tbSearch"/>')}0!=a.collapsible?(c.click(function(){popSearch(this,e)}),b.append(c)):(b.css({right:5}),"left"==i&&b.css({left:5})),b.append(d),f&&$(f).append(b),g&&g.length>0&&$(".tbSearch",f).searchbox({width:h,searcher:function(b,c){"function"==typeof a.callback&&a.callback(b,c)},menu:$(".toolbar_menu",f),prompt:"请输入关键字"}),"none"==$(".search-div").closest(".layout-panel-north").css("display")&&setTimeout(function(){$("#searchArr",f).addClass("search-down-arr").removeClass("search-up-arr")},200)}function addTab(a){addNewTab(a,!1)}function addBlankTab(a){addNewTab(a,!0)}function addNewTab(a){{var b=a.title,c=a.href,d=(a.icon,a.iframed||!0),e=a.refreshed||!1;a.closabled}"undefined"==typeof d&&(d=!0);var f=$("#mainTabs");f.tabs("exists",b)?(f.tabs("select",b),e&&f.tabs("refreshTab",b)):f.tabs("add",{title:b,href:c,iniframe:d,showMask:!0,closable:!0})}Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},window.console&&"undefined"==typeof window.console.time&&(console.time=function(a,b){if(a){var c=(new Date).getTime();console.timeCounters||(console.timeCounters={});var d="KEY"+a.toString();(b||!console.timeCounters[d])&&(console.timeCounters[d]=c)}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var c="KEY"+a.toString(),d=console.timeCounters[c];if(d){var e=b-d,f=a+": "+e+"ms";console.info(f),delete console.timeCounters[c]}return e}}),$(function(){$("input.ipt").mouseover(function(){$(this).addClass("ipt-focus")}).mouseout(function(){$(this).removeClass("ipt-focus")}),$("#clearBtn").live("click",function(){var a=$(this).closest("form");a.form("clear")}),"function"==typeof parsePage&&parsePage(),$(document).hotKeys({type:"keydown",key:"backspace",fn:function(a){$(a.target).is("input")||(a.preventDefault(),a.stopPropagation())}})});var onlyOpenTitle="系统桌面";!function(a){dgSelector=function(b){var c=b.href||"",d=b.title,e=b.onSave||null,f=b.width||null,g=b.height||null,h=b.isFrame;"undefined"==typeof h&&(h=!0),top.dgSelectorOpts=b;var i=!1;return ygDialog({title:d,href:c,width:f,height:g,isFrame:h,modal:!0,showMask:!0,onSave:e,onLoad:function(c,d){var e=d.tbgrid,f=a(this);if(null==e&&(e=b.tbGrid||a("#dialog_SearchDataGrid")),null!=b.queryUrl){var g=a("#dgSelectorSearchBtn"),h=a("#dgSelectorClearBtn"),j=a("#dgSelectorConfirmBtn");g.click(function(){var c=a("#dialog_SarchForm");e.datagrid("options").queryParams=c.form("getData"),e.datagrid("options").url=b.queryUrl,e.datagrid("load")}),h.click(function(){a("#dialog_SarchForm").form("clear")}),j&&j.click(function(){var a=e.datagrid("getSelections");return a.length<=0?(showWarn("请选择后再操作！"),!1):("function"==typeof top.dgSelectorOpts.fn&&top.dgSelectorOpts.fn(a),void c.close())})}b.autoQuery&&setTimeout(function(){g.trigger("click")},100),e.datagrid({onDblClickRow:function(b,d){if("function"==typeof top.dgSelectorOpts.fn){top.dgSelectorOpts.fn(d,b);try{a(top.iptSearchInputObj)[0]&&a(top.iptSearchInputObj).hasClass("easyui-validatebox")&&a(top.iptSearchInputObj).validatebox("validate")}catch(e){}}c.close()},onLoadSuccess:function(){a("input[name=optsel]",f.contents()).on("click",function(){var b=a("input[name=optsel]",f.contents()).index(this),d=e.datagrid("getRows")[b];"function"==typeof top.dgSelectorOpts.fn&&(_fn=top.dgSelectorOpts.fn,top.dgSelectorOpts.fn(d),a(top.iptSearchInputObj)[0]&&a(top.iptSearchInputObj).hasClass("easyui-validatebox")&&a(top.iptSearchInputObj).validatebox("validate")),c.close()}),"string"==typeof b.hkid&&(yg_hotKeys.setOptions({targetId:"dialog_SearchDataGrid",editable:!1,eventKey:!1,enterKey:!0,winTarget:c,fn:top.dgSelectorOpts.fn,editIndex:0}),i=!0)}})},onClose:function(){if(i){var c=a("#"+b.hkid);yg_hotKeys.setOptions({targetId:b.hkid,editable:!0,eventKey:!0,enterKey:!1,fn:null,editIndex:c.datagrid("getRowIndex",c.datagrid("getSelected"))}),i=!1}}}),!1}}(jQuery),function($){ygDialog=function(opts){function getTop(a,b){var c;try{c=a.top.document,c.getElementsByTagName}catch(d){return a}return"document"==b.locate||c.getElementsByTagName("frameset").length>0?a:a.top}function setWindowSize(a,b){var c=getTop(a,b),d=$(c).height(),e=$(c).width();if("top"==b.locate||"document"==b.locate)"auto"==b.height&&(b.height=.8*d),"auto"==b.width&&(b.width=.8*e);else{var f=/^#/.test(b.locate)?b.locate:"#"+b.locate;"auto"==b.height&&(b.height=.8*$(f).height()),"auto"==b.width&&(b.width=.8*$(f).width())}}function iframeLoaded(){onLoadCallback&&onLoadCallback.call(iframe,selfRefrence,iframe[0].contentWindow),_top.$(".dialog-button").show(),target.panel("body").children("div.datagrid-mask-msg").remove(),target.panel("body").children("div.datagrid-mask").remove(),iframe.css({visibility:"visible"})}var win;opts=opts||{};var target,winOpts=$.extend({},{isFrame:!1,locate:"document",data:void 0,width:"auto",height:"auto",cache:!1,autoDestroy:!0,minimizable:!1,maximizable:!1,collapsible:!1,resizable:!1,modal:!0,enableSaveButton:!0,enableCloseButton:!0,saveButtonText:"保存",saveButtonIconCls:"icon-save",closeButtonText:"取消",closeButtonIconCls:"icon-cancel",closed:!1,loadMsg:$.fn.datagrid.defaults.loadMsg,showMask:!0,onSave:null},opts),iframe=null,buttons=[];winOpts.isFrame&&!winOpts.target&&(iframe=$("<iframe>").attr("height","100%").attr("width","100%").attr("marginheight",0).attr("marginwidth",0).attr("frameborder",0),iframe.css({visibility:"hidden"}),iframe.attr("src",winOpts.href),delete winOpts.content);var selfRefrence={openWin:function(){return iframe[0].contentWindow},getData:function(a){return winOpts.data?winOpts.data[a]:null},close:function(){target.panel("close")}},_top=getTop(window,winOpts),warpHandler=function(handler){return"function"==typeof handler?function(){handler(selfRefrence)}:"string"==typeof handler&&winOpts.isFrame?function(){iframe[0].contentWindow[handler](selfRefrence)}:"string"==typeof handler?function(){eval(_top[handler])(selfRefrence)}:void 0};setWindowSize(window,winOpts),winOpts.toolbar&&$.isArray(winOpts.toolbar)&&$.each(winOpts.toolbar,function(a,b){b.handler=warpHandler(b.handler)}),winOpts.buttons&&$.isArray(winOpts.buttons)&&$.each(winOpts.buttons,function(a,b){b.handler=warpHandler(b.handler)});var _onClose=winOpts.onClose;winOpts.onClose=function(){winOpts.target&&$(".validatebox-invalid",winOpts.target).removeClass("validatebox-invalid"),$.isFunction(_onClose)&&_onClose.apply(this,arguments),winOpts.autoDestroy&&!winOpts.target&&$(this).dialog("destroy")};var checkButtons=function(a){var b=!1;if(winOpts.buttons)for(var c=0;c<winOpts.buttons.length;c++)if(winOpts.buttons[c].text==a){b=!0;break}return b};if(1==winOpts.enableSaveButton&&winOpts.onSave){var btnSave={text:winOpts.saveButtonText,iconCls:winOpts.saveButtonIconCls,handler:function(){return winOpts.onSave(selfRefrence)}};buttons.push(btnSave)}if(1==winOpts.enableCloseButton&&!checkButtons(winOpts.closeButtonText)){var btnClose={text:winOpts.closeButtonText,iconCls:winOpts.closeButtonIconCls,handler:function(a){a.dialog("close")}};buttons.push(btnClose)}(!$.util.likeArray(winOpts.buttons)||$.util.isString(winOpts.buttons))&&(winOpts.buttons=[]),$.array.merge(winOpts.buttons,buttons),$.each(winOpts.buttons,function(){var a=this.handler;$.isFunction(a)&&(this.handler=function(){a.call(target,target)})}),winOpts.buttons.length||(winOpts.buttons=null);var onLoadCallback=winOpts.onLoad;if(winOpts.onLoad=function(){onLoadCallback&&onLoadCallback.call(this,selfRefrence,_top)},"top"==winOpts.locate||"document"==winOpts.locate)winOpts.isFrame&&iframe&&!winOpts.target?(winOpts.href="",winOpts.showMask&&(winOpts.onBeforeOpen=function(){var a=$(this);$.mask({target:a})}),target=_top.$("<div>").css({overflow:"hidden"}).append(iframe).dialog(winOpts),iframe.bind("load",function(){iframeLoaded()})):winOpts.target?(target=winOpts.target,target.dialog(winOpts),_top.$(".dialog-button").show(),target.panel("body").children("div.datagrid-mask-msg").remove(),target.panel("body").children("div.datagrid-mask").remove()):(target=_top.$("<div>").dialog(winOpts),setTimeout(function(){_top.$(".dialog-button").show()},2));else{var locate=/^#/.test(winOpts.locate)?winOpts.locate:"#"+winOpts.locate;target=$("<div>").appendTo(locate).dialog($.extend({},winOpts,{inline:!0}))}return target}}(jQuery),function(a){a.fn.createTabs=function(b){var b=a.extend({selected:0},b||{}),c=this,d=b.tabs;this.addClass("easyui-tabs").attr("data-options","plain:true,fit:true");for(var e=0;e<d.length;e++){var f=d[e].title,g=d[e].href,h=!1;d[e].lazyload&&(h=d[e].lazyload);var i=a("<div data-options=\"title:'"+f+"',refreshButton:true,lazyload:"+h+'" style="overflow:hidden;"></div>');i.html(h?'<iframe scrolling="auto" frameborder="0"  class="tabs-iframe" lazysrc="'+g+'"></iframe>':'<iframe scrolling="auto" frameborder="0"  class="tabs-iframe" src="'+g+'"></iframe>'),i.appendTo(c)}var j=0;return a(c).tabs({onSelect:function(d,e){var f=a(c).tabs("getSelected"),g=f.panel("options");if(g.lazyload){var h=f.find("iframe");if(!h[0])return;""==h.attr("lazysrc")||0==j&&0!=b.selected||h.attr("src",h.attr("lazysrc")).removeAttr("lazysrc")}j=e}}),a(c).tabs("select",b.selected),c}}(jQuery);